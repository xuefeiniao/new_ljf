<include file="Trade:header1" />
<div class="wrapbody" style="padding: 0px; margin-top: 30px;">
<div class="main" style="width: 100%;">
    <div class="span span8  content">
        <div id="content" style="width: 58%;float: left;">
            <div id="klineImage" class="newKlineImage ">
                <div class="marketImageNew" id="marketImageNew" style="">
                    <iframe style="border-style: none;" border="0" width="100%" height="600" id="market_chart" src="/Trade/specialty?market={$market}"></iframe>
                </div>
            </div>
        </div>
    </div>

    <style>
        .Transaction tr{ background:none repeat scroll 0 0 #0a0a0a; }
        .Transaction tr:hover{ background-color: #1d1b1b;!important; }
        .Transaction td{ background:none repeat scroll 0 0 #0a0a0a; /*! height:32px; */ line-height:32px;text-align: center;width:70px; }
        .Transaction th{ background:none repeat scroll 0 0 #0a0a0a; font-weight:bold; height: 28px; line-height:28px; color: #cccccc;width:70px;padding:0px;text-align:center; }
        .Transaction th span{ padding-right:0px!important;max-width: 80px!important;text-align: center; }
        .right{width: 20%;float: left;overflow: hidden; /*position: relative; right: -20px; margin-top: -630px;margin-right:10px*/}
        .clear{ width: 107%; }
    </style>
    <!--<div class="right" style="min-width: 23%;float: left">
        <div class="clear">
            <div class=" over-hidden">
                <div class="over-auto">
                    <form class="ft_box" id="form-buy">
                        <dl>
                            <dt class="orange">买入</dt>
                            <dd>
                                <p>最佳买价：</p>
                                <span class="orange" id="buy_best_price" onclick="setMaiRu();" style="cursor:pointer;">-</span> {$rmb|strtoupper}/{$xnb|strtoupper}
                                <eq name="C['trade_hangqing']" value="1">
                                    <a style="float: right;margin-right: 60px;color:#e55600;" id="market_hangqing" onclick="hangqing()">今日行情</a>
                                </eq>
                            </dd>
                            <dd>
                                <p>买入价格：</p>
                                <input type="text" id="buy_price" name="price" placeholder="此出价为1个币的价格" value="">
                            </dd>
                            <dd>
                                <p>最大可买：</p>
                                <span class="col_333" id="buy_max" title="满仓(全买)，设置买入数量为最大值">-</span> {$xnb|strtoupper}
                            </dd>
                            <dd>
                                <p>买入比例：</p>
                                <div class="slider_wrap">
                                    <div id="ratio_num_buy" class="ratio">0%</div>
                                    <div class="sliderbox">
                                        <div id="slider_buy" class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                            <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                            <a data_slide="buy" class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 0%;"></a>
                                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 0%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </dd>
                            <dd>
                                <p>买入数量：</p>
                                <input type="text" id="buy_num" name="num">
                            </dd>
                            <dd>
                                <p>总价：</p>
                                <span class="col_333" id="buy_mum">-</span> {$rmb|strtoupper}
                            </dd>
                            <dd>
                                <p>手续费：</p>
                                {:C('market')[$market]['fee_buy']}%
                            </dd>
                            <dd class="pwdtrade">
                                <p>交易密码：</p>
                                <input id="buy_paypassword" name="pwtrade" type="password"> <span onclick="layertpwd()"
                                                                                                  class="settings"></span>
                            </dd>


                            <eq name="showPW" value="0">
                                <dd style="color:#ff0000">
                                    您设置了不需要输入交易密码
                                </dd>
                            </eq>

                            <eq name="showPW" value="2">
                                <dd style="color:#ff0000">
                                    根据设置本次不需要输入交易密码
                                </dd>
                            </eq>


                        </dl>
                        <div>
                            <div class="trader_btn">
                                <div class="tan_btn" id="tm-buy"></div>
                                <input type="button" value="买入" onclick="tradeadd_buy();">
                            </div>
                        </div>
                    </form>
                    <form class="ft_box nobr" id="form-sell">
                        <dl>
                            <dt class="green">卖出</dt>
                            <dd>
                                <p>最佳卖价：</p>
                                <span class="orange" id="sell_best_price"  onclick="setMaiChu();"  style="color: #690!important;cursor:pointer;">-</span>
                                {$rmb|strtoupper}/{$xnb|strtoupper}

                                <eq name="C['trade_hangqing']" value="1">
                                    <a style="float: right;margin-right: 60px;color:#e55600;" id="market_hangqing"
                                       onclick="hangqing()">今日行情</a>
                                </eq>
                            </dd>
                            <dd>
                                <p>卖出价格：</p>
                                <input type="text" id="sell_price" name="price" placeholder="此出价为1个币的价格"/>
                            </dd>
                            <dd>
                                <p>最大可卖：</p>
                                <span id="sell_max" class="col_333">-</span> {$xnb|strtoupper}
                            </dd>
                            <dd>
                                <p>卖出比例：</p>
                                <div class="slider_wrap">
                                    <div id="ratio_num_sell" class="ratio">0%</div>
                                    <div class="sliderbox">
                                        <div id="slider_sell"
                                             class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                            <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                            <a data_slide="sell" class="ui-slider-handle ui-state-default ui-corner-all"
                                               href="#" style="left: 0%;"></a>
                                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"
                                                 style="width: 0%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </dd>
                            <dd>
                                <p>卖出数量：</p>
                                <input type="text" id="sell_num" name="num">
                            </dd>
                            <dd>
                                <p>总价：</p>
                                <span class="col_333" id="sell_mum">-</span> {$rmb|strtoupper}
                            </dd>
                            <dd>
                                <p>手续费：</p>
                                {:C('market')[$market]['fee_sell']}%
                            </dd>


                            <dd class="pwdtrade">
                                <p>交易密码：</p>
                                <input id="sell_paypassword" name="pwtrade" type="password"> <span onclick="layertpwd()"
                                                                                                   class="settings"></span>
                            </dd>

                            <eq name="showPW" value="0">
                                <dd style="color:#ff0000">
                                    您设置了不需要输入交易密码

                                </dd>
                            </eq>

                            <eq name="showPW" value="2">
                                <dd style="color:#ff0000">
                                    根据设置本次不需要输入交易密码
                                </dd>
                            </eq>


                        </dl>
                        <div>
                            <div class="trader_btn">
                                <div class="tan_btn" id="tm-sell"></div>
                                <input class="bg_green" type="button" value="卖出" onclick="tradeadd_sell();">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>-->
    <div class="right">
        <div class="clear">
            <div class=" over-hidden">
                <div class="over-auto">
                    <table class="Transaction no-border-left  no-border-left-right">
                        <thead>
                        <tr>
                            <th width="70">时间</th>
                            <th width="70">价格</th>
                            <th width="100">数量</th>
                            <th><span style="padding-right: 18px;">金额</span></th>
                        </tr>
                        </thead>
                    </table>
                    <div style="_height: 571px; max-height: 571px;; overflow-x: hidden; overflow-y: auto;">
                        <table class="Transaction no-border-left  no-border-left-right">
                            <tbody id="marketorderlist">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .a1{width: 22%;float: left;}
        .ft_box{border-right: none;width: 325px;}
        .ft_box dd{margin-bottom: 16px}
        .ft_box dd p{color: #656565;}
        .ft_box dd input{width: 132px!important;background-color:transparent;color: #ffffff;}
        .slider_wrap .ratio{ position: relative; margin-right: 36px; }
        .trader_btn{width: 200px;}
        #kf1{display: none}
    </style>
    <div class="a1">
        <a name="mark-trade"></a>
        <form class="ft_box" id="form-buy">
            <dl>
                <!--<dt class="orange">买入</dt>-->
                <dd>
                    <p>最佳买价：</p>
                    <span class="orange" id="buy_best_price" onclick="setMaiRu();" style="cursor:pointer;">-</span> {$rmb|strtoupper}/{$xnb|strtoupper}
<!--                    <eq name="C['trade_hangqing']" value="1">
                        <a style="float: right;margin-right: 60px;color:#de211d;" id="market_hangqing" onclick="hangqing()">今日行情</a>
                    </eq>-->
                </dd>
                <dd>
                    <p>买入价格：</p>
                    <input type="text" id="buy_price" name="price" placeholder="此出价为1个币的价格" value="">
                </dd>
                <!--<dd>
                    <p>最大可买：</p>
                    <span class="col_333" id="buy_max" title="满仓(全买)，设置买入数量为最大值">-</span> {$xnb|strtoupper}
                </dd>-->
<!--                <dd>
                    <p>买入比例：</p>
                    <div class="slider_wrap">
                        <div id="ratio_num_buy" class="ratio">0%</div>
                        <div class="sliderbox">
                            <div id="slider_buy"
                                 class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                <a data_slide="buy" class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 0%;"></a>
                                <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </dd>-->
                <dd>
                    <p>买入数量：</p>
                    <input type="text" id="buy_num" name="num">
                </dd>
                <!--<dd>
                    <p>总价：</p>
                    <span class="col_333" id="buy_mum">-</span> {$rmb|strtoupper}
                </dd>-->
                <dd>
                    <p>手续费：</p>
                    {:C('market')[$market]['fee_buy']}%
                </dd>
                <dd class="pwdtrade">
                    <p>交易密码：</p>
                    <input id="buy_paypassword" name="pwtrade" type="password"> <span onclick="layertpwd()"class="settings"></span>
                </dd>


                <eq name="showPW" value="0">
                    <dd style="color:#ff0000">
                        您设置了不需要输入交易密码
                    </dd>
                </eq>

                <eq name="showPW" value="2">
                    <dd style="color:#ff0000">
                        根据设置本次不需要输入交易密码
                    </dd>
                </eq>


            </dl>
            <div>
                <div class="trader_btn">
                    <div class="tan_btn" id="tm-buy"></div>
                    <input type="button" value="买入" onclick="tradeadd_buy();">
                </div>
            </div>
        </form>
        <form class="ft_box nobr" id="form-sell">
            <dl>
                <!--<dt class="green">卖出</dt>-->
                <dd>
                    <p>最佳卖价：</p>
                    <span class="orange" id="sell_best_price"  onclick="setMaiChu();"  style="color: #690!important;cursor:pointer;">-</span>
                    {$rmb|strtoupper}/{$xnb|strtoupper}

<!--                    <eq name="C['trade_hangqing']" value="1">
                        <a style="float: right;margin-right: 60px;color:#de211d;" id="market_hangqing"
                           onclick="hangqing()">今日行情</a>
                    </eq>-->
                </dd>
                <dd>
                    <p>卖出价格：</p>
                    <input type="text" id="sell_price" name="price" placeholder="此出价为1个币的价格"/>
                </dd>
                <!--<dd>
                    <p>最大可卖：</p>
                    <span id="sell_max" class="col_333">-</span> {$xnb|strtoupper}
                </dd>-->
<!--                <dd>
                    <p>卖出比例：</p>
                    <div class="slider_wrap">
                        <div id="ratio_num_sell" class="ratio">0%</div>
                        <div class="sliderbox">
                            <div id="slider_sell"
                                 class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                <a data_slide="sell" class="ui-slider-handle ui-state-default ui-corner-all"
                                   href="#" style="left: 0%;"></a>
                                <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"
                                     style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </dd>-->
                <dd>
                    <p>卖出数量：</p>
                    <input type="text" id="sell_num" name="num">
                </dd>
                <!--<dd>
                    <p>总价：</p>
                    <span class="col_333" id="sell_mum">-</span> {$rmb|strtoupper}
                </dd>-->
                <dd>
                    <p>手续费：</p>
                    {:C('market')[$market]['fee_sell']}%
                </dd>


                <dd class="pwdtrade">
                    <p>交易密码：</p>
                    <input id="sell_paypassword" name="pwtrade" type="password"> <span onclick="layertpwd()"
                                                                                       class="settings"></span>
                </dd>

                <eq name="showPW" value="0">
                    <dd style="color:#ff0000">
                        您设置了不需要输入交易密码

                    </dd>
                </eq>

                <eq name="showPW" value="2">
                    <dd style="color:#ff0000">
                        根据设置本次不需要输入交易密码
                    </dd>
                </eq>


            </dl>
            <div>
                <div class="trader_btn">
                    <div class="tan_btn" id="tm-sell"></div>
                    <input class="bg_green" type="button" value="卖出" onclick="tradeadd_sell();">
                </div>
            </div>
        </form>
    </div>
      <!--<div id="content-trade" class="content">
          <div class="box mt20" id="Titletrd">
              <div class="clear over-auto  account_table">
                  <div class="left   over-auto" style="width: 32%; margin-right: 5px; border-right: 1px solid #D5D5D5; border-left: 1px solid #D5D5D5;">
                   <div class="over-auto account_table">
                    <table class="Transaction no-border-left">
                     <thead>
                      <tr>
                       <th width="50">买入</th>
                       <th width="80">价格</th>
                       <th width="120">数量</th>
                       <th width=""><span style="padding-right: 18px;">比例</span></th>
                      </tr>
                     </thead>
                    </table>
                    <div style="_height: 852px; max-height: 852px; overflow-x: hidden; overflow-y: auto;">
                     <table class="Transaction no-border-left">
                      <tbody id="marketbuylist">
                      </tbody>
                     </table>
                    </div>
                   </div>
                  </div>-->
      <!--<div class="left  over-auto" style="width: 32%; border-right: 1px solid #D5D5D5; border-left: 1px solid #D5D5D5;">
       <div class="over-auto">
        <table class="Transaction no-border-right">
         <thead>
          <tr>
           <th width="50">卖出</th>
           <th width="80">价格</th>
           <th width="120">数量</th>
           <th width=""><span style="padding-right: 18px;">比例</span></th>
          </tr>
         </thead>
        </table>
        <div style="_height: 852px; max-height: 852px; overflow-x: hidden; overflow-y: auto;">
         <table class="Transaction no-border-right">
          <tbody id="marketselllist">
          </tbody>
         </table>
        </div>
       </div>
      </div>

     </div>
    </div>
   </div>-->
</div>
<br>
<br>

<script type="text/javascript">
	var market="{$market}";

	function getJsonData(){
		$.getJSON("/Chart/getJsonData?market="+market+"&t="+Math.random(),function(data){
			if(data){
				if(data[0]){
					$("#marketbuylist").html(data[0]);
				}
				if(data[1]){
					$("#marketselllist").html(data[1]);
				}
				if(data[2]){
					$("#marketorderlist").html(data[2]);
				}
			}
		});
	}
	getJsonData();

	/*// 倒计时
	var wait=second=5;
	var go=setInterval(function(){
		wait--;
		if(wait<0){
			getJsonData();
			wait=second;
		}
	},1000);*/
</script>


<script type="text/javascript">
    var market = "{$market}";
    var market_round = "{$C['market'][$market]['round']}";
    var market_round_num = 8 - "{$C['market'][$market]['round']}";
    var userid = "{$Think.session.userId}";
    var trade_moshi = 1;
    var getDepth_tlme = null;
    var trans_lock = 0;

    var time = 5;
    var isInterval = setInterval(function () {
        $('#coins_timer').html(time + 's后刷新');
        time--;
        if (time == -1) {
            //clearInterval(isInterval);
            time=5;
        }
    }, 1000);




    /*function hangqing() {
        layer.alert("交易市场:{:C('market')[$market]['title']}<br><br>" +
            "昨日收盘价:{$C['market'][$market]['hou_price']|NumToStr}<br>" +
            "今日涨幅限制：{:C('market')[$market]['zhang']}%<br>" +
            "今日跌幅限制：{:C('market')[$market]['die']}%<br>" +
            "今日买入最小交易价:{$C['market'][$market]['buy_min']|NumToStr}<br>" +
            "今日卖出最大交易价:{$C['market'][$market]['sell_max']|NumToStr}<br>",
            {title: '今日行情',});
    }*/


    function moshi(id) {
        trade_moshi = id;
        $('.trade_moshi').removeClass('on');
        $('#trade_moshi_' + id).addClass('on');
        if (id == 3) {
            $('#selllist').hide();
        } else {
            $('#selllist').show();
        }

        if (id == 4) {
            $('#buylist').hide();
        } else {
            $('#buylist').show();
        }

        if (id == 2) {
            //$('#trade_moshi_liaotian_2').hide();
            //$('#trade_moshi_liaotian_1').show();
            getChat();
        } else {
            $('#trade_moshi_liaotian_2').show();
            //$('#trade_moshi_liaotian_1').hide();
            getDepth();
        }
    }


    function layertpwd() {
        var html = '<div id="all_mask" class="all_mask"></div><div id="tpwd" class="all_mask_loginbox">' +
            '<div class="login_title pl20">交易密码输入设置</div><form id="tpwdsetting" class="set_verify">' +
            '<ul class="tpwd"><li><label for="only"><input type="radio" id="only" value="1" name="aaatpwdsetting"> 每次登录只输入一次交易密码 </label></li><li>' +
            '<label for="every"><input type="radio" checked id="every" value="2" name="aaatpwdsetting"> 每笔交易都输入交易密码</label></li><li><label for="none">' +
            '<input type="radio" id="none" name="aaatpwdsetting" value="3"> 每次交易都不需要输入交易密码</label></li><li><input type="password" id="aaapaypassword" name="paypassword" placeholder="请输入交易密码" class="text"/>' +
            '</li></ul><div class="save_verify"><input type="button" value="保存" onclick="tpwdsettingaa()" /></div><div class="mask_wrap_close" id="pwd_close"></div></form></div>';
        $('body').append(html);
        $('#tpwd').css('top', ($(window).height() / 2) - (265 / 2) + $(document).scrollTop());
        $('.all_mask').css({'height': $(document).height()});
        $('#pwd_close').click(function () {
            $('#tpwd').remove();
            $('#all_mask').remove();
            $('#all_mask').remove();
        })


        $.get('/user/tpwdsetting', function (d) {
            if (d == 1) {
                $('#only').prop('checked', true);
            }
            if (d == 2) {
                $('#every').prop('checked', true);
            }
            if (d == 3) {
                $('#none').prop('checked', true);
            }


        })
    }

    //保存交易密码设置
    function tpwdsettingaa() {
        var paypassword = $("#aaapaypassword").val();
        var tpwdsetting = $("input[name='aaatpwdsetting']:checked").val();
        if (paypassword == "" || paypassword == null) {
            layer.tips('请输入交易密码', '#paypassword', {tips: 3});
            return false;
        }
        if (tpwdsetting == "" || tpwdsetting == null) {
            layer.tips('请输入选择一个', '#tpwdsetting', {tips: 3});
            return false;
        }


        $.post('/user/uptpwdsetting', {paypassword: paypassword, tpwdsetting: tpwdsetting}, function (d) {
            if (d.status) {
                layer.msg('设置成功', {icon: 1});
                window.location.reload();
            } else {
                layer.msg(d.info, {icon: 2});
            }

        }, 'json');
    }

    function tradeadd_buy() {
        if (trans_lock) {
            layer.msg('不要重复提交', {icon: 2});
            return;
        }
        trans_lock = 1;

        var price = parseFloat($('#buy_price').val());
        var num = parseFloat($('#buy-num').val());
        var paypassword = $('#buy_paypassword').val();
        if (price == "" || price == null) {
            layer.tips('请输入内容', '#buy_price', {tips: 3});
            return false;
        }
        if (num == "" || num == null) {
            layer.tips('请输入内容', '#buy_num', {tips: 3});
            return false;
        }

        //加载层-风格3
        layer.load(2);


        //此处演示关闭
        setTimeout(function () {
            layer.closeAll('loading');
            trans_lock = 0;
        }, 10000);
        $.post("{:U('Trade/upTrade')}", {
            price: $('#buy_price').val(),
            num: $('#buy_num').val(),
            paypassword: $('#buy_paypassword').val(),
            market: market,
            type: 1
        }, function (data) {
            layer.closeAll('loading');
            trans_lock = 0;
            if (data.status == 1) {

                $("#buy_price").val('');
                $("#buy_num").val('');
                $("#sell_price").val('');
                $("#sell_num").val('');
                layer.msg(data.info, {icon: 1});
            } else {
                layer.msg(data.info, {icon: 2});
            }
        }, 'json');
    }

    function tradeadd_sell() {
        if (trans_lock) {
            layer.msg('不要重复提交', {icon: 2});
            return;
        }
        trans_lock = 1;
        var price = parseFloat($('#sell_price').val());
        var num = parseFloat($('#sell_num').val());
        var paypassword = $('#sell_paypassword').val();
        if (price == "" || price == null) {
            layer.tips('请输入内容', '#sell_price', {tips: 3});
            return false;
        }
        if (num == "" || num == null) {
            layer.tips('请输入内容', '#sell_num', {tips: 3});
            return false;
        }
        layer.load(2);
        //此处演示关闭
        setTimeout(function () {
            layer.closeAll('loading');
            trans_lock = 0;
        }, 10000);


        $.post("{:U('Trade/upTrade')}", {
            price: $('#sell_price').val(),
            num: $('#sell_num').val(),
            paypassword: $('#sell_paypassword').val(),
            market: market,
            type: 2
        }, function (data) {
            layer.closeAll('loading');
            trans_lock = 0;
            if (data.status == 1) {
                $("#buy_price").val('');
                $("#buy_num").val('');
                $("#sell_price").val('');
                $("#sell_num").val('');
                layer.msg(data.info, {icon: 1});
            } else {
                layer.msg(data.info, {icon: 2});
            }
        }, 'json');
    }


    //撤销
    function cancelaa(id) {
        $.post("{:U('Trade/chexiao')}", {id: id}, function (data) {
            if (data.status == 1) {
                getEntrustAndUsercoin();
                layer.msg(data.info, {icon: 1});
            } else {
                layer.msg(data.info, {icon: 2});
            }
        });
    }

    function getTradelog() {
        $.getJSON("/Ajax/getTradelog?market=" + market + "&t=" + Math.random(), function (data) {
            if (data) {
                if (data['tradelog']) {
                    var list = '';
                    var type = '';
                    var typename = '';
                    for (var i in data['tradelog']) {
                        if (data['tradelog'][i]['type'] == 1) {
                            list += '<tr title="以这个价格卖出" onclick="autotrust(this,\'buy\',2)"><td class="buy"   width="180">' + data['tradelog'][i]['addtime'] + '</td><td class="buy"   width="80">买</td><td class="buy"   width="250">' + data['tradelog'][i]['price'] + '</td><td class="buy"  width="250">' + data['tradelog'][i]['num'] + '</td><td class="buy">' + data['tradelog'][i]['mum'] + '</td></tr>';
                        } else {
                            list += '<tr title="以这个价格买入" onclick="autotrust(this,\'sell\',2)"><td class="sell"   width="180">' + data['tradelog'][i]['addtime'] + '</td><td class="sell"   width="80">卖</td><td class="sell"   width="250">' + data['tradelog'][i]['price'] + '</td><td class="sell"  width="250">' + data['tradelog'][i]['num'] + '</td><td class="sell">' + data['tradelog'][i]['mum'] + '</td></tr>';
                        }
                    }
                    $("#orderlist").html(list);
                }
            }
        });
        setTimeout('getTradelog()', 5000);
    }

    function getDepth() {
        if (trade_moshi != 2) {

            $.getJSON("/Ajax/getDepth?market=" + market + "&trade_moshi=" + trade_moshi + "&t=" + Math.random(), function (data) {
                if (data) {

                    if (data['depth']) {
                        var list = '';
                        var sellk = data['depth']['sell'].length;
                        if (data['depth']['sell']) {
                            for (i = 0; i < data['depth']['sell'].length; i++) {
                                list += '<dl title="以这个价格买入" style="cursor: pointer;" onclick="autotrust(this,\'sell\',1)"><dt class="sell"  style="width: 40px;padding-left: 5px;">卖' + (sellk - i) + '</dt><dd class="sell"  style="width: 90px">' + data['depth']['sell'][i][0] + '</dd><dd class="sell"  style="width: 110px">' + data['depth']['sell'][i][1] + '</dd><dd class="sell"  style="width: 100px">' + (data['depth']['sell'][i][0] * data['depth']['sell'][i][1]).toFixed(6) + '</dd></dl>';
                            }

                        }
                        $("#selllist").html(list);
                        list = '';
                        if (data['depth']['buy']) {
                            for (i = 0; i < data['depth']['buy'].length; i++) {
                                list += '<dl title="以这个价格卖出" style="cursor: pointer;" onclick="autotrust(this,\'buy\',1)"><dt class="buy"  style="width: 40px;padding-left: 5px;">买' + (i + 1) + '</dt><dd class="buy"  style="width: 90px">' + data['depth']['buy'][i][0] + '</dd><dd class="buy"  style="width: 110px">' + data['depth']['buy'][i][1] + '</dd><dd class="buy"  style="width: 100px">' + (data['depth']['buy'][i][0] * data['depth']['buy'][i][1]).toFixed(6) + '</dd></dl>';
                            }

                        }
                        $("#buylist").html(list);
                    }

                }
            });
            clearInterval(getDepth_tlme);

            var wait = second = 5;
            getDepth_tlme = setInterval(function () {
                wait--;
                if (wait < 0) {
                    clearInterval(getDepth_tlme);
                    getDepth();
                    wait = second;
                }
            }, 1000);
        }
    }

    function getEntrustAndUsercoin() {
        $.getJSON("/Ajax/getEntrustAndUsercoin?market=" + market + "&t=" + Math.random(), function (data) {
            if (data) {
                if (data['entrust']) {
                    $('#entrust_over').show();
                    var list = '';
                    var cont = data['entrust'].length;
                    for (i = 0; i < data['entrust'].length; i++) {
                        if (data['entrust'][i]['type'] == 1) {
                            list += '<tr title="以这个价格卖出" onclick="autotrust(this,\'buy\',2)"><td class="buy">' + data['entrust'][i]['addtime'] + '</td><td class="buy">买</td><td class="buy">' + data['entrust'][i]['price'] + '</td><td class="buy">' + data['entrust'][i]['num'] + '</td><td class="buy">' + data['entrust'][i]['deal'] + '</td><td class="buy">' + (data['entrust'][i]['price'] * data['entrust'][i]['num']).toFixed(6) + '</td><td><a style="color: #2674FF;" class="cancelaa" id="' + data['entrust'][i]['id'] + '" onclick="cancelaa(\'' + data['entrust'][i]['id'] + '\')" href="javascript:void(0);">撤销</a></td></tr>';
                        } else {
                            list += '<tr title="以这个价格买入" onclick="autotrust(this,\'sell\',2)"><td class="sell">' + data['entrust'][i]['addtime'] + '</td><td class="sell">卖</td><td class="sell">' + data['entrust'][i]['price'] + '</td><td class="sell">' + data['entrust'][i]['num'] + '</td><td class="sell">' + data['entrust'][i]['deal'] + '</td><td class="sell">' + (data['entrust'][i]['price'] * data['entrust'][i]['num']).toFixed(6) + '</td><td><a style="color: #2674FF;" class="cancelaa" id="' + data['entrust'][i]['id'] + '" onclick="cancelaa(\'' + data['entrust'][i]['id'] + '\')" href="javascript:void(0);">撤销</a></td></tr>';
                        }
                    }
                    if (cont == 10) {
                        list += '<tr><td style="text_align:center;" colspan="7"><a href="/Finance/mywt" style="color: #2674FF;">更多委托信息</a>&nbsp;&nbsp;</td></tr>';
                    }
                    $('#entrustlist').html(list);
                } else {
                    $('#entrust_over').hide();
                }

                if (data['usercoin']) {
                    if (data['usercoin']['cny']) {
                        $("#my_rmb").html(data['usercoin']['cny']);
                    } else {
                        $("#my_rmb").html('0.00');
                    }

                    if (data['usercoin']['cnyd']) {
                        $("#my_rmbd").html(data['usercoin']['cnyd']);
                    } else {
                        $("#my_rmbd").html('0.00');
                    }

                    if (data['usercoin']['xnb']) {
                        $("#my_xnb").html(data['usercoin']['xnb']);
                    } else {
                        $("#my_xnb").html('0.00');
                    }

                    if (data['usercoin']['xnbd']) {
                        $("#my_xnbd").html(data['usercoin']['xnbd']);
                    } else {
                        $("#my_xnbd").html('0.00');
                    }
                }

            }
        });
        $.getJSON("/Ajax/allfinance?t=" + Math.random(), function (data) {

            $('#user_finance').html(data);
        });


        setTimeout('getEntrustAndUsercoin()', 5000);
    }


    $(function () {
        getTradelog();
        getDepth();
        if (userid > 0) {
            getEntrustAndUsercoin();
        } else {
            $('#entrust_over').hide();
        }


    });


    function toNum(num, round) {
        return Math.round(num * Math.pow(10, round) - 1) / Math.pow(10, round);
    }




    // 自动填价格
    function autotrust(_this, type, cq) {

        if (type == 'sell') {
            $('#buy_price').val($(_this).children().eq(cq).html()).css({'font_size': '14px'});
            if ($("#my_rmb").html() > 0) {
                $("#buy_max").html(toNum(($("#my_rmb").html() / $('#buy_price').val()), market_round_num));
            }
            if ($('#buy_num').val()) {
                $("#buy_mum").html(($('#buy_num').val() * $('#buy_price').val()).toFixed(8) * 1);
            }

        }
        if (type == 'buy') {
            $('#sell_price').val($(_this).children().eq(cq).html()).css({'fontSize': '14px'});
            if ($("#my_xnb").html() > 0) {
                $("#sell_max").html($("#my_xnb").html());
            }
            if ($('#sell_num').val()) {
                $("#sell_mum").html(($('#sell_num').val() * $('#sell_price').val()).toFixed(8) * 1);
            }
        }

    }

    function  setMaiChu(){
        $('#sell_price').val($.trim($('#sell_best_price').html().replace('￥', '')));
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / buyprice;
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }

        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }

    }

    function setMaiRu(){
        $('#buy_price').val($.trim($('#buy_best_price').html().replace('￥', '')));
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / buyprice;
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }

        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }
    }


    $('#buy_price,#buy_num,#sell_price,#sell_num').css("ime-mode", "disabled").bind('keyup change', function () {
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / buyprice;
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }
        //alert("wobianliao");

        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }
    }).bind("paste", function () {
        return false;
    }).bind("blur", function () {
        if (this.value.slice(-1) == ".") {
            this.value = this.value.slice(0, this.value.length - 1);
        }
    }).bind("keypress", function (e) {
        var code = (e.keyCode ? e.keyCode : e.which); //兼容火狐 IE
        if (this.value.indexOf(".") == -1) {
            return (code >= 48 && code <= 57) || (code == 46);
        } else {
            return code >= 48 && code <= 57
        }
    });


</script>

<script type="text/javascript" src="__PUBLIC__/Home/js/jquery-ui.js"></script>
<script type="text/javascript">
    $(function () {
        slider();
    });
    // 买入/卖出 比例
    function slider() {
        var type = ['sell', 'buy'];
        for (var i in type) {
            $("#slider_" + type[i]).slider({
                value: 0, min: 0, max: 100, step: 10, range: "min", slide: function (a, t) {
                    var type = $(t.handle).attr('data_slide');
                    var e = parseFloat($("#" + type + '_max').text());
                    if (isNaN(e)) e = 0;
                    $("#" + type + ' .ui-slider-handle').addClass('ui-state-focus ui-state-active');
                    $("#" + type + "_num").val((e / 100 * t.value).toFixed(market_round_num));
                    $("#ratio_num_" + type).text(t.value + "%");
                    if ($('#' + type + '_price').val()) {
                        $("#" + type + "_mum").html(((e / 100 * t.value * $('#' + type + '_price').val())).toFixed(2) * 1);
                    }
                }
            })
        }
    }
</script>


<script>
	//菜单高亮
	$('#list-tab_chart').addClass('on');
</script>
<!-- <include file="Public:footer_1" /> -->